{% extends "base_entrepreneur.html" %}
{% load static %}
{% load i18n %}

{% block title %}{{ project.title }} - {% trans "Contributions a mes Projets" %}{% endblock %}

{% block base_entrepreneur %}
<div class="container py-4">
  <!-- Projet Card -->
  <div class="card mb-4 shadow-sm border-0">
    {% if project.image %}
      <img src="{{ project.image.url }}" class="card-img-top" alt="{{ project.title }}">
    {% else %}
      <img src="{% static 'assets/img/default_project.jpg' %}" class="card-img-top" alt="Default Project">
    {% endif %}
    <div class="card-body">
      <h3 class="card-title fw-bold">{{ project.title }}</h3>
      <p class="text-muted mb-2">
        <i class="bi bi-geo-alt"></i> {{ project.country.name }}
      </p>
      <p class="card-text mb-2">{{ project.short_description }}</p>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <span class="badge 
          {% if project.status == 'approved' %}bg-success
          {% elif project.status == 'pending_review' %}bg-warning text-dark
          {% elif project.status == 'rejected' %}bg-danger
          {% elif project.status == 'completed' %}bg-info text-dark
          {% else %}bg-secondary{% endif %}">
          {{ project.get_status_display }}
        </span>
        <small class="text-muted">
          <i class="bi bi-clock"></i> {{ project.created_at|date:"d/m/Y" }}
        </small>
      </div>

      <!-- Barre de progression globale -->
      <div class="mt-3">
        <label class="fw-bold mb-1">{% trans "Progression globale" %} : {{ progress_percentage }}%</label>
        <div class="progress" style="height: 20px;">
          <div class="progress-bar bg-primary" role="progressbar" style="width: {{ progress_percentage }}%;" aria-valuenow="{{ progress_percentage }}" aria-valuemin="0" aria-valuemax="100">
            {{ progress_percentage }}%
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contributions List -->
  <h4 class="mb-3">{% trans "Contributions des investisseurs" %}</h4>

  {% if contributions %}
  <div class="row g-3">
    {% for c in contributions %}
    <div class="col-md-6 col-lg-4">
      <div class="card shadow-sm border-0 h-100 hover-shadow">
        <div class="card-body">
          <h5 class="card-title fw-bold">{{ c.investor_name }}</h5>
          <p class="text-muted mb-1"><i class="bi bi-cash-stack"></i> {{ c.amount }} FCFA</p>
          <p class="mb-2">
            <span class="badge 
              {% if c.payment_status == 'pending' %}bg-warning text-dark
              {% elif c.payment_status == 'completed' %}bg-success
              {% elif c.payment_status == 'failed' %}bg-danger
              {% else %}bg-secondary{% endif %}">
              {{ c.payment_status|capfirst }}
            </span>
          </p>

          <!-- Barre de progression individuelle -->
          <label class="fw-bold mb-1">{% trans "Pourcentage du projet" %}: {{ c.percentage }}%</label>
          <div class="progress" style="height: 16px;">
            <div class="progress-bar bg-info" role="progressbar" style="width: {{ c.percentage }}%;" aria-valuenow="{{ c.percentage }}" aria-valuemin="0" aria-valuemax="100">
              {{ c.percentage }}%
            </div>
          </div>
        </div>
        <div class="card-footer bg-light border-0 text-end">
          <small class="text-muted">
            <i class="bi bi-clock"></i> {{ c.created_at|date:"d/m/Y" }}
          </small>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info text-center py-4">
    <i class="bi bi-folder-x fs-3"></i>
    <p class="mt-2 mb-0">{% trans "Aucune contribution enregistr√©e pour le moment." %}</p>
  </div>
  {% endif %}
</div>

<style>
.hover-shadow:hover {
  transform: translateY(-5px);
  transition: all 0.3s ease;
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
}
.progress-bar {
  font-size: 0.85rem;
  line-height: 16px;
}
</style>
{% endblock base_entrepreneur %}
