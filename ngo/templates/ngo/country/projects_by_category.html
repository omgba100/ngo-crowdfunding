{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{{ category.name }} – {% trans "Projets financés" %}{% endblock %}

{% block content %}

<!-- ============================= HERO SECTION ============================= -->
<section class="hero-category d-flex align-items-center justify-content-center text-center position-relative"
  style="background: linear-gradient(rgba(48,60,130,0.85), rgba(23,71,142,0.85)), url('{% static 'assets/img/about/hero-bg.jpg' %}') center/cover no-repeat; min-height: 45vh;">
  <div data-aos="zoom-in" data-aos-duration="1200">
    <h1 class="fw-bold text-white display-5">{{ category.name }}</h1>
    <p class="lead text-white-50">{% trans "Projets financés dans la catégorie" %} {{ category.name }} – {{ country.name }}</p>
  </div>
</section>

<!-- ============================= PROJECT LIST ============================= -->
<section class="py-5" style="background-color: var(--bg-primary);">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="fw-bold text-uppercase" style="color: var(--text-title);" data-aos="fade-up">
        {% trans "Projets financés" %}
      </h2>
      <div class="divider mx-auto my-3" style="width: 80px; height: 4px; background-color: var(--accent);" data-aos="zoom-in"></div>
    </div>

    <div class="row g-4">
      {% for project in projects %}
      <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="{{ forloop.counter|add:'100' }}">
        <div class="project-card border-0 rounded-4 shadow-lg overflow-hidden" data-tilt data-tilt-max="8">
          <div class="project-img position-relative">
            {% if project.image %}
              <img src="{{ project.image.url }}" alt="{{ project.title }}" class="w-100" style="height: 220px; object-fit: cover;">
            {% else %}
              <img src="{% static 'assets/img/projects/default.jpg' %}" alt="placeholder" class="w-100" style="height: 220px; object-fit: cover;">
            {% endif %}
            <div class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center text-center">
              <h5 class="fw-bold text-white">{{ project.title }}</h5>
            </div>
          </div>

          <div class="p-4 bg-white">
            <p class="text-muted small mb-3">{{ project.short_description|truncatechars:120 }}</p>

            <div class="progress mb-3" style="height: 8px; border-radius: 10px;">
              <div class="progress-bar" role="progressbar"
                   style="width: {{ project.funding_percentage|floatformat:0 }}%; background-color: var(--bg-secondary);"
                   aria-valuenow="{{ project.funding_percentage|floatformat:0 }}"
                   aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <small class="d-block mb-2 text-muted">
              {{ project.collected_amount|floatformat:0 }} / {{ project.target_amount|floatformat:0 }} {{ country.currency.code }}
            </small>

            <a href="{% url 'projects_by_category' country_slug=country.slug category_slug=category.slug %}" 
               class="btn btn-sm fw-bold w-100"
               style="background-color: var(--bg-tertiary); color: var(--text-white); border-radius: 50px;">
              {% trans "Voir le projet" %}
            </a>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center py-5">
        <p class="text-muted fs-5">{% trans "Aucun projet financé trouvé dans cette catégorie pour ce pays." %}</p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- ============================= STYLES & SCRIPTS ============================= -->
<link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css">
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.3/vanilla-tilt.min.js"></script>

<script>
  AOS.init({ duration: 900, offset: 120, once: true });
  VanillaTilt.init(document.querySelectorAll("[data-tilt]"));
</script>

<style>
  .project-card {
    transition: transform 0.4s ease, box-shadow 0.4s ease;
    background: linear-gradient(135deg, #fff, var(--bg-primary));
  }
  .project-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  }
  .overlay {
    background: rgba(23,71,142,0.75);
    opacity: 0;
    transition: opacity 0.4s ease;
  }
  .project-card:hover .overlay {
    opacity: 1;
  }
  .divider {
    border-radius: 10px;
  }
</style>

{% endblock %}
